(this.webpackJsonp=this.webpackJsonp||[]).push([[9],{424:function(t,e,n){t.exports=n(29)(1571)},472:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var a=n(109),r=n.n(a),i=n(0),o=n.n(i),s=n(503);function c(t){var e=Object(i.useRef)(null),n=Object(s.a)(e),a=Object(i.useState)(!1),c=r()(a,2),u=c[0],l=c[1],f=t.height,h=t.throttle,v=void 0===h?200:h;return Object(i.useEffect)((function(){var e;switch(!0){case t.unmountIfInvisible:e=setTimeout((function(){return l("visible"===n)}),v);break;case"visible"===n:e=setTimeout((function(){return l(!0)}),v)}return function(){return e&&clearTimeout(e)}}),[n]),o.a.createElement("div",{ref:e,style:{minHeight:f,width:"100%"}},u?t.children:null)}},638:function(t,e,n){"use strict";n.r(e);var a=n(434),r=n.n(a),i=n(433),o=n.n(i),s=n(504),c=n.n(s),u=n(451),l=n.n(u),f=n(424),h=n.n(f),v=n(419),d=n.n(v),m=n(626),p=n.n(m),w=n(476),U=n.n(w),g=n(109),y=n.n(g),b=n(0),M=n.n(b),A={unpack_cascade:function(t){var e=new DataView(new ArrayBuffer(4)),n=8;e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]);var a=e.getInt32(0,!0);n+=4,e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]);var r=e.getInt32(0,!0);n+=4;for(var i=[],o=[],s=[],c=0;c<r;++c){Array.prototype.push.apply(i,[0,0,0,0]),Array.prototype.push.apply(i,t.slice(n,n+4*Math.pow(2,a)-4)),n=n+4*Math.pow(2,a)-4;for(var u=0;u<Math.pow(2,a);++u)e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]),o.push(e.getFloat32(0,!0)),n+=4;e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]),s.push(e.getFloat32(0,!0)),n+=4}var l=new Int8Array(i),f=new Float32Array(o),h=new Float32Array(s);return function(t,e,n,i,o){t*=256,e*=256;for(var s=0,c=0,u=Math.pow(2,a)>>0,v=0;v<r;++v){for(var d=1,m=0;m<a;++m)d=2*d+(i[(t+l[s+4*d+0]*n>>8)*o+(e+l[s+4*d+1]*n>>8)]<=i[(t+l[s+4*d+2]*n>>8)*o+(e+l[s+4*d+3]*n>>8)]);if((c+=f[u*v+d-u])<=h[v])return-1;s+=4*u}return c-h[r-1]}},run_cascade:function(t,e,n){for(var a=t.pixels,r=t.nrows,i=t.ncols,o=t.ldim,s=n.shiftfactor,c=n.minsize,u=n.maxsize,l=n.scalefactor,f=c,h=[];f<=u;){for(var v=Math.max(s*f,1)>>0,d=f/2+1>>0,m=d;m<=r-d;m+=v)for(var p=d;p<=i-d;p+=v){var w=e(m,p,f,a,o);w>0&&h.push([m,p,f,w])}f*=l}return h},cluster_detections:function(t,e){t=t.sort((function(t,e){return e[3]-t[3]}));for(var n,a,r,i,o,s,c,u,l,f,h=new Array(t.length).fill(0),v=[],d=0;d<t.length;++d)if(0==h[d]){for(var m=0,p=0,w=0,U=0,g=0,y=d;y<t.length;++y)n=t[d],a=t[y],r=void 0,i=void 0,o=void 0,s=void 0,c=void 0,u=void 0,l=void 0,f=void 0,r=n[0],i=n[1],o=n[2],s=a[0],c=a[1],u=a[2],l=Math.max(0,Math.min(r+o/2,s+u/2)-Math.max(r-o/2,s-u/2)),f=Math.max(0,Math.min(i+o/2,c+u/2)-Math.max(i-o/2,c-u/2)),l*f/(o*o+u*u-l*f)>e&&(h[y]=1,m+=t[y][0],p+=t[y][1],w+=t[y][2],U+=t[y][3],g+=1);v.push([m/g,p/g,w/g,U])}return v},instantiate_detection_memory:function(t){for(var e=0,n=[],a=0;a<t;++a)n.push([]);return function(t){n[e]=t,e=(e+1)%n.length,t=[];for(var a=0;a<n.length;++a)t=t.concat(n[a]);return t}}},E=A,k={unpack_localizer:function(t){var e=new DataView(new ArrayBuffer(4)),n=0;e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]);var a=e.getInt32(0,!0);n+=4,e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]);var r=e.getFloat32(0,!0);n+=4,e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]);var i=e.getInt32(0,!0);n+=4,e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]);var o=e.getInt32(0,!0);n+=4;for(var s=[],c=[],u=0;u<a;++u)for(var l=0;l<i;++l){Array.prototype.push.apply(s,t.slice(n,n+4*Math.pow(2,o)-4)),n=n+4*Math.pow(2,o)-4;for(var f=0;f<Math.pow(2,o);++f)for(var h=0;h<2;++h)e.setUint8(0,t[n+0]),e.setUint8(1,t[n+1]),e.setUint8(2,t[n+2]),e.setUint8(3,t[n+3]),c.push(e.getFloat32(0,!0)),n+=4}var v=new Int8Array(s),d=new Float32Array(c);function m(t,e,n,s,c,u,l){for(var f=0,h=Math.pow(2,o)>>0,m=0;m<a;++m){for(var p=0,w=0,U=0;U<i;++U){for(var g=0,y=0;y<o;++y){var b=Math.min(c-1,Math.max(0,256*t+v[f+4*g+0]*n>>8)),M=Math.min(u-1,Math.max(0,256*e+v[f+4*g+1]*n>>8)),A=Math.min(c-1,Math.max(0,256*t+v[f+4*g+2]*n>>8)),E=Math.min(u-1,Math.max(0,256*e+v[f+4*g+3]*n>>8));g=2*g+1+(s[b*l+M]>s[A*l+E])}var k=2*(i*h*m+h*U+g-(h-1));p+=d[k+0],w+=d[k+1],f+=4*h-4}t+=p*n,e+=w*n,n*=r}return[t,e]}return function(t,e,n,a,r){for(var i=[],o=[],s=0;s<a;++s){var c=n*(.925+.15*Math.random()),u=t+.15*n*(.5-Math.random()),l=e+.15*n*(.5-Math.random()),f=m(u,l,c,r.pixels,r.nrows,r.ncols,r.ldim),h=y()(f,2);u=h[0],l=h[1],i.push(u),o.push(l)}return i.sort(),o.sort(),[i[Math.round(a/2)],o[Math.round(a/2)]]}}},x=k;var I=function(t,e){var n=this;this.ctx=t,this.callback=e;var a=document.createElement("div");this.video=document.createElement("video"),this.video.setAttribute("autoplay","1"),this.video.setAttribute("playsinline","1"),this.video.setAttribute("width",1),this.video.setAttribute("height",1),a.appendChild(this.video),document.body.appendChild(a),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((function(t){n.video.srcObject=t,n.update()}),(function(t){throw t})),this.update=function(){var t=this,e=Date.now();requestAnimationFrame((function n(){var a=Date.now-e;t.callback(t.video,a),e=Date.now(),requestAnimationFrame(n)}))}};function j(t,e,n){for(var a=new Uint8Array(e*n),r=0;r<e;++r)for(var i=0;i<n;++i)a[r*n+i]=(2*t[4*r*n+4*i+0]+7*t[4*r*n+4*i+1]+1*t[4*r*n+4*i+2])/10;return a}var O=function(t){var e=t.score,n=void 0===e?600:e,a=t.onSnapshot,r=void 0===a?function(){}:a,i=Object(b.useRef)(n),o=Object(b.useRef)(null);return Object(b.useEffect)((function(){i.current=n}),[n]),Object(b.useEffect)((function(){var t=o.current.getContext("2d"),e=E.instantiate_detection_memory(5),n=fetch("./data/puploc.bin").then((function(t){return t.arrayBuffer()})).then((function(t){return x.unpack_localizer(new Int8Array(t))})),a=fetch("./data/facefinder").then((function(t){return t.arrayBuffer()})).then((function(t){return E.unpack_cascade(new Int8Array(t))}));Promise.all([a,n]).then((function(n){var a=y()(n,2),o=a[0],s=a[1];new I(t,(function(n,a){t.drawImage(n,0,0);var c={pixels:j(t.getImageData(0,0,640,480).data,480,640),nrows:480,ncols:640,ldim:640},u=E.run_cascade(c,o,{shiftfactor:.1,minsize:100,maxsize:1e3,scalefactor:1.1});u=e(u),u=E.cluster_detections(u,.2);for(var l=0;l<u.length;++l)if(u[l][3]>i.current){t.beginPath(),t.arc(u[l][1],u[l][0],u[l][2]/2,0,2*Math.PI,!1),t.lineWidth=3,t.strokeStyle="red",t.stroke();var f=u[l][0]-.075*u[l][2],h=u[l][1]-.175*u[l][2],v=.35*u[l][2],d=s(f,h,v,63,c),m=y()(d,2);f=m[0],h=m[1],f>=0&&h>=0&&(t.beginPath(),t.arc(h,f,1,0,2*Math.PI,!1),t.lineWidth=3,t.strokeStyle="red",t.stroke()),f=u[l][0]-.075*u[l][2],h=u[l][1]+.175*u[l][2],v=.35*u[l][2];var p=s(f,h,v,63,c),w=y()(p,2);if(f=w[0],h=w[1],f>=0&&h>=0&&(t.beginPath(),t.arc(h,f,1,0,2*Math.PI,!1),t.lineWidth=3,t.strokeStyle="red",t.stroke()),f>=0&&h>=0){var U=t.canvas.toDataURL();r(U,u[l][3])}}}))}))}),[]),M.a.createElement("canvas",{width:640,height:480,ref:o})},_=n(472);e.default=function(){var t=Object(b.useState)([]),e=y()(t,2),n=e[0],a=e[1],i=Object(b.useState)(600),s=y()(i,2),u=s[0],f=s[1],v=Object(b.useCallback)((function(t,e){a((function(n){return[].concat(U()(n),[{src:t,score:e}])}))}),[]),m=Object(b.useCallback)((function(t){a([]),f(t)}),[]);return M.a.createElement(M.a.Fragment,null,M.a.createElement(d.a,{style:{marginBottom:24}},"Accuracy:",M.a.createElement(p.a,{defaultValue:600,max:1500,min:50,marks:{1500:"1500",50:"50"},onAfterChange:m,style:{width:200}}),M.a.createElement("div",{style:{marginTop:40}},M.a.createElement(O,{onSnapshot:v,score:u}))),M.a.createElement(d.a,null,M.a.createElement(c.a,{grid:{lg:2,md:1,xs:1}},M.a.createElement(o.a,{gutter:16},h()(n,(function(t,e){return M.a.createElement(c.a.Item,{key:e},M.a.createElement(_.a,{height:480,throttle:200,unmountIfInvisible:!0},M.a.createElement("div",{style:{marginBottom:8}},M.a.createElement(l.a,{color:"red"},t.score)),M.a.createElement("div",null,M.a.createElement("img",{src:t.src}))))}))))),M.a.createElement(r.a,null))}}}]);